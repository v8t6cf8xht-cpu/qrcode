<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>åº«å­˜æƒæç³»çµ±</title>

<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
body { font-family: Arial; margin: 20px; }
label { display: block; margin-top: 12px; font-weight: bold; }
input, textarea { width: 220px; margin-top: 5px; padding: 6px; }
button { padding: 6px 12px; margin: 4px 4px 0 0; cursor: pointer; }
#video { width: 320px; border: 1px solid #ccc; margin-top: 10px; }

table { border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }

/* å„²ä½æŒ‰éˆ• */
.loc-btn {
  border: 1px solid #999;
  background: #f5f5f5;
}
.loc-btn.active {
  background: #2ecc71;
  color: #fff;
  border-color: #27ae60;
}

/* å‚™è¨»æŒ‰éˆ• */
.note-btn { color:#fff; border:none; }
.red { background:#e74c3c; }
.orange { background:#e67e22; }
.blue { background:#3498db; }
.gray { background:#95a5a6; color:#000; }
</style>
</head>
<body>

<h2>ğŸ“¦ åº«å­˜æƒæç³»çµ±</h2>

<video id="video" autoplay></video>

<label>æ–™è™Ÿ</label>
<input id="item" readonly>

<label>å‹è™Ÿ</label>
<input id="model" readonly>

<label>å„²ä½ï¼ˆé»é¸ï¼‰</label>
<div id="locationButtons">
  <button class="loc-btn" data-loc="C10-1">C10-1</button>
  <button class="loc-btn" data-loc="C10-2">C10-2</button>
  <button class="loc-btn" data-loc="C10-5">C10-5</button>
</div>

<label>æ•¸é‡</label>
<input id="qty" type="number" value="1" min="1" inputmode="numeric" pattern="[0-9]*">

<label>å‚™è¨»</label>
<div>
  <button class="note-btn red" data-note="ä¸è‰¯å“">ä¸è‰¯å“</button>
  <button class="note-btn orange" data-note="å¾…ä¿®å“">å¾…ä¿®å“</button>
  <button class="note-btn blue" data-note="å¾…æ­¸ä½">å¾…æ­¸ä½</button>
  <button class="note-btn gray" data-note="å…¶ä»–">å…¶ä»–</button>
</div>
<textarea id="note" rows="2" placeholder="é¸å…¶ä»–æ™‚è¼¸å…¥"></textarea>

<br>
<button id="saveBtn">å„²å­˜</button>
<button id="nextBtn" disabled>ä¸‹ä¸€å€‹</button>
<button id="exportBtn">åŒ¯å‡º Excel</button>

<h3>ç´€éŒ„åˆ—è¡¨</h3>
<table id="recordTable">
<tr>
  <th>æ™‚é–“</th><th>æ–™è™Ÿ</th><th>å‹è™Ÿ</th>
  <th>å„²ä½</th><th>æ•¸é‡</th><th>å‚™è¨»</th><th>æ“ä½œ</th>
</tr>
</table>

<script>
/* ===== æ–™è™Ÿ â†’ å‹è™Ÿ ===== */
const itemModelMap = {
  "CRJ-31-100MA": "Primary current: 20~600A-Second output: 100mA",
"CT24J1200T01": "5VA-1200 5A",
"ESCT-TU10-20A": "Split core CT-Type:ESCT-TA10",
"ESCT-TU16-150A": "Split core CT-Type:ESCT-TA16",
"ESCT-TU24-300A": "Split core CT-Type:ESCT-TA24",
"ESCT-TU36-600A": "Split core CT-Type:ESCT-TA36",
"F200015101": "2 port RS-422 485 device server",
"F200015102": "UPort 1130   1 Port USB-to-Serial Adaptor , RS-422 485",
"P111000100": "BEW-1ABA 110V 10(40)A ",
"P111000400": "BAW-1HBA 10(50)A ",
"P111000500": "BAW-1HCA 20(80)A",
"P114000100": "BAW-1CBBA 10(50)A  (å…¼å®¹110V)(RS485)",
"P114000300": "BAW-1CHBA 10(80)A  TV(RS485)",
"P115000300": "è®€å¡æ©Ÿ BAW-RL",
"P115000800": "ICå¡ç”¨é›»é ä»˜è²»è£ç½® BAW-RA åŠ å€¼æ©Ÿ ( é™„é›»æºè®Šå£“å™¨ã€ç®¡ç†å¡ã€è²»ç‡å¡ )",
"P115000901": "BAW-1AHBA 10(80)A  ",
"P117000100": "DIN Rail Electronic Energy Meter CED-1CBEA 5(100)A 50  CL.1",
"P118000100": "BAW-1DHBA 10(80)A ",
"P121000400": "BAW-2CCA 20(80)A ",
"P122000100": "BEW-3BAA 5A ",
"P122000400": "BAW-3HAA 5(20)A",
"P122000600": "BAW-3HCA 20(100)A  ",
"P125000300": "BAW-2CCBA 10(80)A  (RS485)",
"P126000300": "BAW-3CBCA 20(100)A  (å…¼å®¹110V)(RS485)",
"P128000400": "BAW-2ACBA 10(80)A ",
"P131000100": "BEW-4EAA 5A (å…¼å®¹110 190V)",
"P131000200": "BEW-4EBA 10(50)A (å…¼å®¹110 190V)",
"P131000300": "BEW-4ECA 20(100)A (å…¼å®¹110 190V)",
"P131000700": "BAW-4GAA 5(20)A ",
"P131000800": "BAW-4GBA 10(50)A ",
"P131000900": "BAW-4GCA 20(100)A ",
"P133000100": "BAW-4CGAA 5(20)A   (RS485)",
"P133000400": "BAW-4CGBA 10(100)A   (RS485)",
"P135000100": "CED-4CFEA 220 380V 5(80)A 50  CL.1",
"P135000101": "CED-4CFBA 230 400V 10(100)A 50 ",
"P135000201": "CED-4CFAA 230 400V 5(6)A 50 ",
"P135000500": "CED-4C ML Multi-parameters 1p2w, 1p3w,3p3w,3p4w",
"P136000100": "CMFM-F 50-600V  1A 5A 45-66Hz  CL0.5",
"P136000200": "CMFM-G 50-600V  1A 5A 45-66Hz  CL0.5 TOU",
"RJ12-100": "10.0 meter",
"Z3-C160120TH": "120A 1A-1VA 1.0",
"Z3-C240050TH": "50A 5A-0.5VA 5.0",
"Z3-C240100TH": "100A 5A-1VA 1.0 (UD-0552-4)",
"Z3-C240150TH": "150A 5A-1VA 1.0 (UD-0552-4)",
"Z3-C240200TH": "200A 5A-1VA 1.0 (UD-0552-4)",
"Z3-C240300TH": "300A 5A-2.5VA 1.0 (UD-0552-4)",
"Z3-C360400TH": "400A 5A -2.5VA 1.0(UD-0552-4)",
"Z3-C360500TH": "500A 5A-7.5VA 1.0 (UD-0552-4)",
"Z3-C360600TH": "600A 5A-12.5VA 1.0 (UD-0552-4)",
"Z3-C500700TH": "700A 5A-5VA 1.0 (UD-0552-4)",
"Z3-C500800TH": "800A 5A-12.5VA 1.0 (UD-0552-4)",
"A111600400": "Top cover Assembly BAW-1~2",
"A111600500": "Terminal cover Assembly BAW-1 1P2W",
"A111700300": "Register BAW-1~4 A11",
"A111900300": "Chassis Assembly BAW-1HBA 10(80)A ",
"A115000100": "é›»æºè®Šå£“å™¨BAW-RA KG- 9V1.3A",
"A115000200": "IC CARD (Print)",
"A115000300": "Optical head",
"A115000400": "Signal cable",
"A121900300": "Chassis Assembly BAW-2  10(80)A",
"A122600400": "Top cover Assembly BAW-3~4",
"A122600500": "Terminal cover Assembly BAW-3 3P3W-direct-type",
"A122900400": "Chassis Assembly BAW-3  10(100)A",
"A1240001-00": "é›»è¡¨é›»æ±  FDK-CR2 3-8LHT-CN240S",
"A1240002-00": "AMIé›»è¡¨é›»æ±  TOSHIBA ER4V 3.6V-1200mAh",
"A124902300": "æ’åº§çµ„ç«‹åœ“è¡¨",
"A131600700": "Terminal cover Assembly BAW-4 3P4W-direct-type",
"A131600800": "Terminal cover Assembly BAW-4 3P4W-CT",
"A131900100": "Chassis Assembly BAW-4 5(20)A",
"A131900400": "Chassis Assembly BAW-4  10(100)A",
"C111700111": "Ã˜3x6mm è‡ªæ”»èºçµ²åå­—åœ“é ­",
"C111700211": "Ã˜3x8mm è‡ªæ”»èºçµ²åå­—åœ“é ­",
"C111700448-00": "BAWç“¦æ™‚è¨ˆå¤–ç®±(30å…¥)",
"C111700548-00": "BAWç“¦æ™‚è¨ˆå¤–ç®±(12å…¥) ",
"C111700948-00": "BAWé ä»˜è²»é›»è¡¨å¤–ç®±(12å…¥ 18å…¥)",
"P115000100": "BAW-1ABBA 10(50)A ",
"P121000300": "BAW-2CBA 10(50)A ",
"P122000500": "BAW-3HBA 10(50)A  V",
"P123000100": "BAW-2DCBA 10(80)A ",
"P125000100": "BAW-2CCBA 10(50)A  (RS485)",
"P125000200": "BAW-2CCCA 20(80)A  (RS485)",
"P126000100": "BAW-3CHAA 5(20)A (RS485)",
"P126000200": "BAW-3CBBA 10(50)A (å…¼å®¹110V)(RS485)",
"P126000400": "BAW-3CHBA 10(100)A (RS485)",
"P133000200": "BAW-4CGBA 10(50)A  (RS485)",
"P133000300": "BAW-4CGCA 20(100)A  (RS485)",
"P135000200": "DIN Rail Electronic Energy Meter CED-4CFAA 220 380V 1.5(6)A 50  CL.1 é™„è®Šæ¯”å™¨ç”¨",
"P111000600": "BAW-1HBA 10(80)A",
"P121000500": "BAW-2CBA 10(80)A",
"P122000700": "BAW-3HBA 10(100)A",
"P131001000": "BAW-4GBA 10(100)A",

};

/* ===== å„²ä½é¸æ“‡ ===== */
let selectedLocation = "";
document.querySelectorAll(".loc-btn").forEach(btn=>{
  btn.onclick = ()=>{
    document.querySelectorAll(".loc-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    selectedLocation = btn.dataset.loc;
  }
});

/* ===== å‚™è¨»æŒ‰éˆ• ===== */
document.querySelectorAll(".note-btn").forEach(btn=>{
  btn.onclick = ()=>{
    if(btn.dataset.note === "å…¶ä»–") {
      document.getElementById("note").focus();
    } else {
      document.getElementById("note").value = btn.dataset.note;
    }
  }
});

/* ===== ç›¸æ©Ÿæƒæ ===== */
const video = document.getElementById("video");
const canvas = document.createElement("canvas");
const ctx = canvas.getContext("2d");
let scanning = true;

navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" }})
.then(stream=>{
  video.srcObject = stream;
  video.setAttribute("playsinline", true);
  requestAnimationFrame(scanLoop);
});

function scanLoop(){
  if(video.readyState === video.HAVE_ENOUGH_DATA && scanning){
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video,0,0);
    const img = ctx.getImageData(0,0,canvas.width,canvas.height);
    const code = jsQR(img.data, img.width, img.height);
    if(code){
      scanning = false;
      item.value = code.data;
      model.value = itemModelMap[code.data] || "ï¼ˆæœªè¨­å®šå‹è™Ÿï¼‰";
      nextBtn.disabled = false;
      qty.focus();
    }
  }
  requestAnimationFrame(scanLoop);
}

/* ===== å„²å­˜ ===== */
saveBtn.onclick = ()=>{
  if(!item.value || !selectedLocation){
    alert("è«‹ç¢ºèªå·²æƒææ–™è™Ÿä¸¦é¸æ“‡å„²ä½");
    return;
  }
  const row = recordTable.insertRow();
  row.innerHTML = `
    <td>${new Date().toLocaleString()}</td>
    <td>${item.value}</td>
    <td>${model.value}</td>
    <td>${selectedLocation}</td>
    <td>${qty.value}</td>
    <td>${note.value}</td>
    <td><button onclick="this.parentNode.parentNode.remove()">åˆªé™¤</button></td>
  `;
  saveBtn.disabled = true;
};

/* ===== ä¸‹ä¸€å€‹ ===== */
nextBtn.onclick = ()=>{
  item.value = model.value = note.value = "";
  qty.value = 1;
  selectedLocation = "";
  document.querySelectorAll(".loc-btn").forEach(b=>b.classList.remove("active"));
  saveBtn.disabled = false;
  nextBtn.disabled = true;
  scanning = true;
};

/* ===== åŒ¯å‡º Excel ===== */
exportBtn.onclick = ()=>{
  const wb = XLSX.utils.table_to_book(recordTable, {sheet:"åº«å­˜ç´€éŒ„"});
  XLSX.writeFile(wb,"åº«å­˜ç´€éŒ„.xlsx");
};
</script>

</body>
</html>

